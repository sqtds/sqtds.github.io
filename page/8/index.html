<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>蜻蜓点水</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="蜻蜓点水">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="蜻蜓点水">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="蜻蜓点水">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="蜻蜓点水" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?1bd1f966e3148e2b59e4b159067ad372";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img lazy-src="/img/photo.jpg" class="js-avatar">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">sqtds</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags/随笔">随笔</a></li>
				        
							<li><a href="/about">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/sqtds" title="github">github</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
								<a class="mail" target="_blank" href="/sqtds@163.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/android/" style="font-size: 15.71px;">android</a> <a href="/tags/antlr4/" style="font-size: 18.57px;">antlr4</a> <a href="/tags/hadoop/" style="font-size: 11.43px;">hadoop</a> <a href="/tags/impala/" style="font-size: 10px;">impala</a> <a href="/tags/java/" style="font-size: 11.43px;">java</a> <a href="/tags/java核心系列/" style="font-size: 20px;">java核心系列</a> <a href="/tags/java源码阅读/" style="font-size: 12.86px;">java源码阅读</a> <a href="/tags/linux/" style="font-size: 14.29px;">linux</a> <a href="/tags/linux命令/" style="font-size: 10px;">linux命令</a> <a href="/tags/mondrian/" style="font-size: 18.57px;">mondrian</a> <a href="/tags/netty/" style="font-size: 10px;">netty</a> <a href="/tags/nosql/" style="font-size: 11.43px;">nosql</a> <a href="/tags/spring/" style="font-size: 14.29px;">spring</a> <a href="/tags/tomcat/" style="font-size: 17.14px;">tomcat</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/异常/" style="font-size: 10px;">异常</a> <a href="/tags/性能/" style="font-size: 10px;">性能</a> <a href="/tags/数据库/" style="font-size: 15.71px;">数据库</a> <a href="/tags/缓存/" style="font-size: 10px;">缓存</a> <a href="/tags/计算机原理/" style="font-size: 15.71px;">计算机原理</a> <a href="/tags/随笔/" style="font-size: 11.43px;">随笔</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">sqtds</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/photo.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">sqtds</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
					<li><a href="/about">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/sqtds" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
						<a class="mail" target="_blank" href="/sqtds@163.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-2014/spring-tx1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/09/2014/spring-tx1/" class="article-date">
  	<time datetime="2014-06-09T14:40:09.000Z" itemprop="datePublished">2014-06-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/09/2014/spring-tx1/">spring事务原理1-事务的抽象</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概要">概要</h3><p>spring事务包含3个最主要的接口PlatformTransactionManager，TransactionStatus，TransactionDefinition 。其中PlatformTransactionManager负责管理事务的边界，<br>TransactionStatus负责描述事务的状态，TransactionDefinition定义事务相关属性，例如隔离级别，传播行为等。</p>
<h3 id="PlatformTransactionManager">PlatformTransactionManager</h3><p>PlatformTransactionManager 的整个抽象体系基于Strategy 模式，由PlatformTransactionManager 对事务界定进行统一抽象，而具体的界定策略的实现则交由具体的实现类。</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PlatformTransactionManager</span> </span>{

  <span class="function">TransactionStatus <span class="title">getTransaction</span><span class="params">(TransactionDefinition definition)</span>
    <span class="keyword">throws</span> TransactionException</span>;

  <span class="function"><span class="keyword">void</span> <span class="title">commit</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;

  <span class="function"><span class="keyword">void</span> <span class="title">rollback</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;
}
</code></pre><h3 id="TransactionDefinition">TransactionDefinition</h3><p>TransactionDefinition定义了事务的相关属性：隔离级别，传播性，超时，只读状态。<br><img src="/img/2014/QQ图片20140609221319.jpg" alt=""></p>
<ul>
<li><p>Isolation: The degree to which this transaction is isolated from the work of other transactions. For example, can this transaction see uncommitted writes from other transactions?</p>
</li>
<li><p>Propagation: Typically, all code executed within a transaction scope will run in that transaction. However, you have the option of specifying the behavior in the event that a transactional method is executed when a transaction context already exists. For example, code can continue running in the existing transaction (the common case); or the existing transaction can be suspended and a new transaction created. Spring offers all of the transaction propagation options familiar from EJB CMT. To read about the semantics of transaction propagation in Spring, see Section 10.5.7, “Transaction propagation”.</p>
</li>
<li><p>Timeout: How long this transaction runs before timing out and being rolled back automatically by the underlying transaction infrastructure.</p>
</li>
<li><p>Read-only status: A read-only transaction can be used when your code reads but does not modify data. Read-only transactions can be a useful optimization in some cases, such as when you are using Hibernate.</p>
</li>
</ul>
<h3 id="TransactionStatus">TransactionStatus</h3><p>org.springframework.transaction.TransactionStatus 接口定义表示整个事务处理过程中的事务状态，更多时候，我们将在编程式事务中使用该接口。 </p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionStatus</span> <span class="keyword">extends</span> <span class="title">SavepointManager</span> </span>{

    <span class="function"><span class="keyword">boolean</span> <span class="title">isNewTransaction</span><span class="params">()</span></span>;

    <span class="function"><span class="keyword">boolean</span> <span class="title">hasSavepoint</span><span class="params">()</span></span>;

    <span class="function"><span class="keyword">void</span> <span class="title">setRollbackOnly</span><span class="params">()</span></span>;

    <span class="function"><span class="keyword">boolean</span> <span class="title">isRollbackOnly</span><span class="params">()</span></span>;

    <span class="function"><span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span></span>;

    <span class="function"><span class="keyword">boolean</span> <span class="title">isCompleted</span><span class="params">()</span></span>;

}
</code></pre><p><img src="/img/2014/QQ图片20140609221008.jpg" alt=""></p>
<p>在事务处理过程中，我们可以使用TransactionStatus 进行如下工作。 </p>
<ul>
<li>使用TransactionStatus 提供的相应方法查询事务状态。 </li>
<li>通过setRollbackOnly() 方法标记当前事务以使其回滚。</li>
<li>如果相应的PlatformTransactionManager支持Savepoint，可以通过TransactionStatus 在当前事务中创建内部嵌套事务。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/java/">java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/spring-tx2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/09/2014/spring-tx2/" class="article-date">
  	<time datetime="2014-06-09T14:40:09.000Z" itemprop="datePublished">2014-06-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/09/2014/spring-tx2/">spring事务原理2-隔离级别</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>spring提供了5种事务的隔离级别：</p>
<h3 id="ISOLATION_DEFAULT">ISOLATION_DEFAULT</h3><p>如果指定隔离级别为ISOLATION_DEFAULT ，则表示使用数据库默认的隔离级别，通常情况下是Read Committed 。</p>
<h3 id="ISOLATION_READ_UNCOMMITTED">ISOLATION_READ_UNCOMMITTED</h3><p>对应Read Uncommitted 隔离级别，无法避免脏读，不可重复读和幻读。</p>
<h3 id="ISOLATION_READ_COMMITTED">ISOLATION_READ_COMMITTED</h3><p>对应Read Committed 隔离级别，可以避免脏读，但无法避免不可重复读和幻读。</p>
<h3 id="ISOLATION_REPEATABLE_READ">ISOLATION_REPEATABLE_READ</h3><p>对应Repeatable read隔离级别，可以避免脏读和不可重复读，但不能避免幻读.</p>
<h3 id="ISOLATION_SERIALIZABLE">ISOLATION_SERIALIZABLE</h3><p>对应Serializable 隔离级别，可以避免所有的脏读，不可重复读以及幻读，但并发性效率最低.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/java/">java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/spring-tx3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/09/2014/spring-tx3/" class="article-date">
  	<time datetime="2014-06-09T14:40:09.000Z" itemprop="datePublished">2014-06-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/09/2014/spring-tx3/">spring事务原理3-事务的传播行为</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="事务的传播行为">事务的传播行为</h3><p>在spring管理的事务中，需要认识到物理和逻辑事务的不同，并且如何设置这些不同。</p>
<ul>
<li>PROPAGATION_REQUIRED</li>
</ul>
<p>如果当前存在一个事务，则加入当前事务。如果不存在任何事务，则创建一个新的事务。总之，要至少保证在一个事务中运行。PROPAGATION_REQUIRED通常作为默认的事务传播行为。<br><img src="/img/2014/QQ图片20140609223017.jpg" alt=""></p>
<ul>
<li>PROPAGATION_SUPPORTS</li>
</ul>
<p>如果当前存在一个事务，则加入当前事务。如果当前不存在事务，则直接执行。对于一些查询方法来说，PROPAGATION_SUPPORTS通常是比较合适的传播行为选择。</p>
<ul>
<li>PROPAGATION_MANDATORY </li>
</ul>
<p>PROPAGATION_MANDATORY 强制要求当前存在一个事务，如果不存在，则抛出异常.</p>
<ul>
<li>PROPAGATION_REQUIRES_NEW</li>
</ul>
<p>不管当前是否存在事务，都会创建新的事务。如果当前存在事务，会将当前的事务挂起（Suspend）。如果某个业务对象所做的事情不想影响到外层事务，PROPAGATION_REQUIRES_NEW 应该是合适的选择。比如，假设当前的业务方法需要向数据库中更新某些日志信息，但即使这些日志信息更新失败，我们也不想因为该业务方法的事务回滚，而影响到外层事务的成功提交。因为这种情况下，当前业务方法的事务成功与否对外层事务来说是无关紧要的。<br><img src="/img/2014/QQ图片20140609223105.jpg" alt=""></p>
<ul>
<li>PROPAGATION_NOT_SUPPORTED</li>
</ul>
<p>不支持当前事务，而是在没有事务的情况下执行。如果当前存在事务的话，当前事务原则上将被挂起（Suspend）.</p>
<ul>
<li>PROPAGATION_NEVER</li>
</ul>
<p>永远不需要当前存在事务，如果存在当前事务，则抛出异常。 </p>
<ul>
<li>PROPAGATION_NESTED</li>
</ul>
<p>如果存在当前事务，则在当前事务的一个嵌套事务中执行，否则与PROPAGATION_REQUIRED 的行为类似，即创建新的事务，在新创建的事务中执行.<br><img src="/img/2014/QQ图片20140609223801.jpg" alt=""></p>
<p>PROPAGATION_NESTED事务是依赖的吧，不可分割的，PROPAGATION_REQUIRES_NEW是独立的，相互分离的。</p>
<p>PROPAGATION_NESTED uses a single physical transaction with multiple savepoints that it can roll back to. Such partial rollbacks allow an inner transaction scope to trigger a rollback for its scope, with the outer transaction being able to continue the physical transaction despite some operations having been rolled back. This setting is typically mapped onto JDBC savepoints, so will only work with JDBC resource transactions. See Spring’s DataSourceTransactionManager.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/java/">java</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/2014plan" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/08/2014/2014plan/" class="article-date">
  	<time datetime="2014-06-08T07:35:09.000Z" itemprop="datePublished">2014-06-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/08/2014/2014plan/">2014年下半年计划</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>2014年已经过去一半了,感觉什么事也没做。<br>上半年买的书都还有大半没看完，进度太慢了。发现再这样下去还是不行的，必须要给自己一点压力，让自己成长起来。so,so,so制定下下半年的计划，不能再这样继续荒废时间了：</p>
<h3 id="plan1：_读书">plan1： 读书</h3><ul>
<li><p>《java性能优化》</p>
<p> 根据书上的性能优化措施,看完了至少能将公司的项目提升一个层次。</p>
</li>
<li><p>《android4高级编程》</p>
<p>希望能上架自己的1,2个小应用，暂时还没想好做什么。</p>
</li>
<li><p>《数据挖掘》《深入浅出数据分析》《大数据》《大规模分布式存储系统》</p>
<p>想办法做好公司的BI系统吧。</p>
</li>
<li><p>《大型网站系统与java中间件架构实践》《大型网站技术架构》《软件架构设计》</p>
<p>要多练练架构才好，不过这些书讲的太过空泛了。</p>
</li>
<li><p>《深入理解计算机系统》《计算机程序的构造和解释》《代码大全》</p>
<p>底层也要多了解了解才好。</p>
</li>
</ul>
<h3 id="plan2：_分析开源框架">plan2： 分析开源框架</h3><ul>
<li>spring</li>
</ul>
<p>感觉对spring的理解还是比较欠缺，下半年努力把spring的方方面面都理解清楚吧。</p>
<ul>
<li>网络，并发</li>
</ul>
<p>netty，concurrent包，这两部分也是需要继续研究的。</p>
<ul>
<li>大数据</li>
</ul>
<p>如果还有精力的话，就研究hadoop的代码吧。</p>
<h3 id="plan3：_锻炼">plan3： 锻炼</h3><ul>
<li><p>每周必须要跑一次步</p>
</li>
<li><p>计划一次爬山</p>
</li>
<li><p>每天至少3分钟平板支撑</p>
</li>
</ul>
<h3 id="plan4：_赚钱">plan4： 赚钱</h3><p>没钱的屌丝，要想办法赚钱呀。</p>
<ul>
<li>炒股</li>
</ul>
<p>炒股就是博弈，人生要敢于冒风险。希望自己的资产能够在过年的时候上涨10%。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/随笔/">随笔</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/其他/">其他</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/linux环境变量加载顺序" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/02/2014/linux环境变量加载顺序/" class="article-date">
  	<time datetime="2014-06-02T15:17:33.000Z" itemprop="datePublished">2014-06-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/02/2014/linux环境变量加载顺序/">linux环境变量的加载顺序</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>当使用export设置环境变量的时候，注意前面的环境变量会覆盖后面设置的环境变量。<br>例如：<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME/usr/java1.<span class="number">7</span></span><br><span class="line">export PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA</span>_HOME/bin</span><br></pre></td></tr></table></figure></p>
<p>当在/etc/profile中设置这2个选项的时候，如果PATH中已经包含了java的运行时环境，那么此设置会失败。</p>
<p>要想使自定义设置生效，最好将自定义的path设置在前面，如下：</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME/usr/java1.<span class="number">7</span></span><br><span class="line">export PATH=<span class="variable">$JAVA</span>_HOME/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/linux/">linux</a>
	</div>


      
        <p class="article-more-link">
          <a  href="/2014/06/02/2014/linux环境变量加载顺序/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/android-Activity生命周期" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/05/25/2014/android-Activity生命周期/" class="article-date">
  	<time datetime="2014-05-25T13:44:43.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/2014/android-Activity生命周期/">理解Android Activity</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>每一个Activity都表示一个屏幕，应用程序会把它呈现给用户。应用程序越复杂，需要的屏幕可能越多。</p>
<p>典型情况下，这至少包括一个用来处理应用程序的主ui功能的主屏幕。这个主界面由许多fragment组成，并且通常由一组次要Activity支持。要在屏幕之间进行切换，就要启动一个新的Activity。</p>
<h2 id="Activity的生存周期">Activity的生存周期</h2><h2 id="1-activity栈">1.activity栈</h2><p>每一个Activity的状态是由它所在Activity栈中所处的位置所决定的，Activity栈是当前所有正在运行的Activity的后进先出的集合。当一个新的Activity启动时，它就变为Activity状态了，并被移动到栈顶。如果用户使用Back（返回）按钮返回到了刚才的Activity，或者前台Activity被关闭了，那么栈中的下一个Activity就会移动到栈顶，变为活动状态。<br><img src="/img/2014/3-7.PNG" alt=""></p>
<h3 id="2-Activity的状态">2.Activity的状态</h3><p>随着Activity的创建和销毁，它们会按照上图从栈中进进出出。在这个过程中，它们经历了一下4中状态：</p>
<ul>
<li><p>活动状态<br>当一个Activity位于栈顶的时候，它是可见的，具有焦点的前台Activity,这时候它可以接收用户输入。Android将会不惜一切代价来保持它处于活动状态，并根据需要来销毁栈下面部分的Activity，以保证这个Activity拥有它所需要的资源。当另一个Activity变为活动状态的时候，这个Activity就被暂停。</p>
</li>
<li><p>暂停状态<br>在某些情况下，Activity是可见的，但是没有获得焦点，此时它就处于暂停状态。当一个透明的或者非全屏的Activity位于该Activity之前时，就会达到这个状态。当Activity被暂停的时候，它任然会被当做近视与活动状态的状态，但是它不能接受用户的输入事件。在极端情况下，Android会终止暂停的Activity，以方便为活动状态的Activity释放资源。当一个Activity变得完全不可见的时候，它就变为停止状态。</p>
</li>
<li><p>停止状态<br>当一个Activity不可见的时候，它就处于停止状态。此时，Activity仍然会停留在内存中，保存所有的状态信息，然而当系统的其他地方要求使用内存的时候，他们就会成为被终止的首要侯选对象。在一个Activity停止的时候，保存数据和当前的UI状态以及停止任何飞关键操作是很重要的。一旦一个Activity被退出或者关闭，它就会变为非活动状态。</p>
</li>
<li><p>非活动状态<br>当一个Activity被终止后，在启动之前它就处于非活动状态。处于非活动状态的Activity已经从Activity栈中删除了，因此，在他们可以被显示和使用之前，需要重新被启动。</p>
</li>
</ul>
<h3 id="3-理解Activity的生命周期">3.理解Activity的生命周期</h3><p><img src="/img/2014/2012120122450787.png" alt=""></p>
<ul>
<li>完整生命周期</li>
</ul>
<p>Activity的完整生成周期是指对OnCreate方法的第一次调用和对OnDestroy方法的最后一次调用之间的时间范围。有时候还会发生一个Activity的进程被终止，却没有调用OoDestory方法的情况。</p>
<p>OnCreate方法来初始化Activity：填充用户界面，得到对Fragment的引用，分配对类变量的引用，将数据绑定到控件，并启动Service和定时器。</p>
<p>OnDestory方法来清理OnCreate方法创建的所有资源，并保证所有的外部连接都被关闭了。</p>
<ul>
<li>可见生存期</li>
</ul>
<p>一个Activity的可见生成期是指调用Onstart和Onstop之间的那段时间。在这个时间段中，Activity是对用户可见的，但是他们可能不具有焦点，或者她可能被部分遮挡了。</p>
<p>OnStop方法应该用来暂停或者停止动画，线程，传感器监听器，GPS查找，定时器，Service或者其他专门用于更新用户界面的进程。当UI不可见的时候它是没有意义的，因为这消耗了资源缺没起到实际的作用。</p>
<p>当UI再次可见的时候，可以使用OnStart或者OnRestart方法来恢复或者重启这些进程。OnRestart在除了对Onstart方法的第一次调用之外的所有方法之前被立即调用。</p>
<ul>
<li>活动生存期</li>
</ul>
<p>活动生存期是指OnResume及对应的OnPause之间的那段时间。</p>
<p>一个处于活动状态的Activity是在前台的，并且正在接受用户输入事件。一定要让OnPause和OnResume中的代码执行迅速，并且其中的代码尽可能的少，以保证在前台和后台之间进行切换的时候应用程序能够迅速响应。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/android-intent" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/05/25/2014/android-intent/" class="article-date">
  	<time datetime="2014-05-25T10:44:43.000Z" itemprop="datePublished">2014-05-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/25/2014/android-intent/">Intent和Broadcast Receiver</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Intent简介">Intent简介</h2><p>Intent是一种消息传递机制，可以在应用程序中使用， 也可以在应用程序间使用。Intent可以用于：</p>
<ul>
<li>使用类名显示启动一个特定的Service或Activity</li>
<li>启动Activity或Service来执行一个动作的Intent，通常需要使用特定的数据，或者对特定的数据执行动作。</li>
<li>广播某个事件的发生。</li>
</ul>
<h3 id="使用Intent来启动Activity">使用Intent来启动Activity</h3><p>显示：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="type">intent</span> = new <span class="type">Intent</span>(MyActivity.this, MyOtherActivity.<span class="keyword">class</span>);</span><br><span class="line">startActivity(<span class="type">intent</span>);</span><br></pre></td></tr></table></figure>
<p>隐式：<br>隐式的Intent提供了一种机制，可以让匿名的应用程序组件响应动作请求。这意味着可以要求系统启动一个可执行给定动作的Activity，而不必知道需要启动哪个应用程序或Activity。</p>
<p>例如：如果希望用户从应用程序中打电话，可以实现一个新的拨号程序，也可以使用一个隐式的Intent来请求一个在电话号码（表示为一个URI）上执行动作（拨号）。<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(somethingWeird&amp;&amp;itDontLookGood)&#123;</span><br><span class="line">	<span class="type">Intent</span> <span class="type">intent</span> = </span><br><span class="line">      new <span class="type">Intent</span> (<span class="type">Intent</span>.Action_DLL,Uri.parse(<span class="string">"tel:555-2368"</span>));</span><br><span class="line">	startActivity(<span class="type">intent</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Android就会解析这个Intent，并启动一个新的Activity，该Activity会提供对这个电话号码进行拨号的动作—-在这种情况下，通常是Phone Dialer.</p>
<h2 id="Linfify简介">Linfify简介</h2><p>Linkify是一个辅助类，它会自动地在TextView类（或者TextView的派生类）中通过RegEx模型匹配来创建超链接。</p>
<p>那些匹配一个指定的RegEx模式的文本都将会被转换为一个可以单击的超链接，这些超链接可以隐式使用匹配的文本作为目标URI来触发startActivity（new Intent(Intent.ACTION_VIEW，uri)）。</p>
<h3 id="原生Linkify链接类型">原生Linkify链接类型</h3><p>Linkify类有一些预设值可以检测到Web URL，电子邮件地址和电话号码，并把他们转换为链接。要应用一个预设值，需要使用静态的Linkify.addLinks方法，并传入要建立的链接的视图，以及以下的一个活更多个自描述的Linkify类常量的位掩码:WEB_URLS，EMAIL_ADDRESS,PHONE_NUMBERS和ALL。</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TextView textView = (TextView)findViewById(R.id.myTextView)<span class="comment">;</span></span><br><span class="line">Linkify.addLinks(textView,Linkify.WEB_URLS|Linkify.EMAIL_ADDRESSES)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>也可以使用Android:autoLink属性来在一个布局内部链接视图。<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView </span><br><span class="line">	android:layout_width = <span class="string">"match_parent"</span></span><br><span class="line">	android:layout_height = <span class="string">"match_parent"</span></span><br><span class="line">	android:<span class="type">text</span> = <span class="string">"@string/linkify_name"</span></span><br><span class="line">	android:autoLink = <span class="string">"phone|email"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="创建定制的链接字符串">创建定制的链接字符串</h3><h3 id="使用Match_Filter">使用Match Filter</h3><h3 id="使用Transform_Filter">使用Transform Filter</h3><p>Transform Filter 允许修改匹配的链接文本生成的隐式URI。把链接文本和目标URI分离开，你能够更自由的决定如何把数据字符串显示给用户。</p>
<h2 id="使用Intent广播事件">使用Intent广播事件</h2><p>作为一个系统级的消息传递机制，Intent可以在进程之间发送结构化的消息。因此，可以通过实现Broadcast Receiver来监听和响应应用程序内的这些Broadcast Intent。</p>
<p>Broadcast Intent 用于向监听器通知系统的应用程序或应用事件，从而可以扩展应用程序间的事件驱动的编程模型。</p>
<p>Broadcast Intent 可以是应用程序更加开发：通过使用Intent来广播一个事件，可以在不用修改原始应用程序的情况下，让你和第三方开发人员对事件做出反应。在应用程序中，可以通过监听Broadcast Intent来对设备状态变化和第三方应用程序事件做出反应。</p>
<h3 id="使用_Intent广播事件">使用 Intent广播事件</h3><p>在应用程序组件中，可以构建希望广播的Intent，然后使用sendBroadcast方法来发送它。</p>
<p>可以对Intent的动作，数据和分类进行设置，从而使Broadcast Receiver能够精确的确定他们的需求。</p>
<h3 id="使用Broadcast_Receiver来监听广播">使用Broadcast Receiver来监听广播</h3><p>Broadcast Receiver可以用来监听Broadcast Intent。要使Broadcast Receiver 能够接受广播，就需要对其进行注册，即可以使用代码，也可以在应用程序的manifest文件中注册。无论怎么注册，都要使用一个Intent Filter来指定它要监听哪些Intent和数据。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/impala-jdbc-pool" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/05/23/2014/impala-jdbc-pool/" class="article-date">
  	<time datetime="2014-05-23T13:44:43.000Z" itemprop="datePublished">2014-05-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/23/2014/impala-jdbc-pool/">impala 使用连接池报“Cannot get a connection, pool exhausted”异常</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在使用dbcp 为impala创建连接池时，创建的时候没有报错，但是取连接的时候发现报错了，错误信息如下:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org<span class="class">.apache</span><span class="class">.commons</span><span class="class">.dbcp</span><span class="class">.SQLNestedException</span>: Cannot get <span class="tag">a</span> connection, pool exhausted</span><br></pre></td></tr></table></figure></p>
<p>通过debug发现连接池中的连接数为0，断定是创建连接池的时候出了异常。<br>于是debug进入commons dbcp的源代码中，发现在PoolableConnectionFactory中的passivateObject(Object obj)方法中出了异常。</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">passivateObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception </span>{
    <span class="keyword">if</span>(obj <span class="keyword">instanceof</span> Connection) {
        Connection conn = (Connection)obj;
        <span class="keyword">if</span>(!conn.getAutoCommit() &amp;&amp; !conn.isReadOnly()) {
            conn.rollback();
        }
        conn.clearWarnings();
        <span class="comment">//由于impala没有事务，所以设置自动提交必然失败</span>
        conn.setAutoCommit(<span class="keyword">true</span>);
    }
    <span class="keyword">if</span>(obj <span class="keyword">instanceof</span> DelegatingConnection) {
        ((DelegatingConnection)obj).passivate();
    }
}
</code></pre><p>发现dbcp代码有问题后，首先看了下版本号1.2.1。进入官网后，发现有1.4的新版本，于是下载下来后，查看源代码：</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">passivateObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception </span>{
    <span class="keyword">if</span>(obj <span class="keyword">instanceof</span> Connection) {
        Connection conn = (Connection)obj;
        <span class="keyword">if</span>(!conn.getAutoCommit() &amp;&amp; !conn.isReadOnly()) {
            conn.rollback();
        }
        conn.clearWarnings();
        <span class="keyword">if</span>(!conn.getAutoCommit()) {
            conn.setAutoCommit(<span class="keyword">true</span>);
        }
    }
    <span class="keyword">if</span>(obj <span class="keyword">instanceof</span> DelegatingConnection) {
        ((DelegatingConnection)obj).passivate();
    }
}
</code></pre><p>发现在1.4的代码中已经先判断连接自动提交的状态再设置。果断更新dbcp后，运行一切正常。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/impala/">impala</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/大数据/">大数据</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/android事件处理2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/05/23/2014/android事件处理2/" class="article-date">
  	<time datetime="2014-05-23T13:44:43.000Z" itemprop="datePublished">2014-05-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/23/2014/android事件处理2/">android 特殊事件处理</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在android中，可能需要一些特定的事件来处理某些任务。下面我们将介绍android中比较特殊的2种事件处理。</p>
<h2 id="响应系统设置事件">响应系统设置事件</h2><p>在开发android中， 我们可能需要让应用程序随着系统的设置而响应。例如判断屏幕的方向，导航的方向等。</p>
<h3 id="Configuration类介绍">Configuration类介绍</h3><p>Configuration类用于描述手机设备上的配置信息，这些配置信息包括用户特定的配置项，也包括系统的动态配置项。</p>
<p><code>Configuration cfg = getResources().getConfiguration();</code></p>
<ul>
<li>fontScale — 来源于system.prop中 sys.font.scale配置项<br>输入设备类型配置：系统加入的任何输入device必须拥有输入属性:现在android中仅支持touchscreen(触摸),keyboard(键盘),navigation(滚动球)</li>
<li>orientation — 屏幕方位</li>
<li>keyboardHidden — 如果是划盖或开盖手机并且没有软键盘支持，这个设成true</li>
<li>hardKeyboardHidden — 如果是划盖或开盖手机,这个设成true</li>
<li>locale — 用户选择的location信息</li>
<li>theme — 皮肤,资源等等</li>
</ul>
<h3 id="重写onConfigurationChanged响应系统设置更改">重写onConfigurationChanged响应系统设置更改</h3><p>如果应用程序需要监听系统设置的更改，则可以考虑重写Activityd的onConfigurationChanged（Configuation newConfig）方法，该方法是一个基于回调的事件处理方法：当系统设置发生更改是，改方法会被自动触发。</p>
<p>为了在程序中动态的更改系统设置，我们可以调用Activity的setRequestedQrientation(int)方法来修改屏幕的方向。</p>
<h2 id="Handler消息传递机制">Handler消息传递机制</h2><p>Android的消息传递机制是另一种形式的“事件处理”，这种机制主要是为了解决Android应用的多线程问题—android平台不允许Activity新启动的线程访问该Activity里的界面组件，这样会导致新启动的线程无法动态改变界面组件的属性值。但在实际Android开发中，尤其是涉及动画的游戏开发中，需要让新启动的线程周期性的改变界面组件的属性值，这就需要借助于Handler的消息传递机制来实现了。</p>
<h3 id="Handler类简介">Handler类简介</h3><p>Handler类的主要作用：</p>
<ul>
<li>在新启动的线程中发送消息。</li>
<li>在主线程中获取，处理消息。</li>
</ul>
<p>为了让主线程能“适时”地处理新启动的线程锁发送的消息，显然只能通过回调的方式来实现—开发者只要重写Handler类中处理消息的方法，当新启动的线程发送消息时，Handler类中处理消息的方法被自动回调。<br>Handler类包含如下方法用于发送，处理消息。<br><img src="/img/2014/QQ图片20140524162001.jpg" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
    <article id="post-2014/android事件处理机制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/05/23/2014/android事件处理机制/" class="article-date">
  	<time datetime="2014-05-23T13:44:43.000Z" itemprop="datePublished">2014-05-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/23/2014/android事件处理机制/">android 事件机制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>android提供了2中事件处理方式:基于回调的事件处理和基于监听器的事件处理。</p>
<h3 id="基于监听的事件处理">基于监听的事件处理</h3><p>在事件监听处理的处理模型中，主要涉及如下3种类型：</p>
<ul>
<li>Event Source（事件源）：事件发生的各个场所，通常是各个组件，例如按钮，窗口，菜单等。</li>
<li>Event（事件）：事件封装了界面组件上发生的特定事件（通常就是一次用户操作）。</li>
<li>Event Listener（事件监听器）：监听事件源发生的事件，对各个事件做出响应。</li>
</ul>
<p>Android的事件处理机制是一种委派式事件处理方式：普通组件（事件源）将整个事件处理委托给特定的对象（事件监听器）；当该事件源发生特定的事件时，就通知所委托的事件监听器，由事件监听器来处理这个事件。<br><img src="/img/2014/QQ图片20140524151941.jpg" alt=""></p>
<h2 id="基于回调的事件处理">基于回调的事件处理</h2><p>如果说事件监听机制是一种委托的事件处理，那么回调机制正好相反：对于基于回调的时间爱你处理模型来说，事件源与事件监听器是统一的，或者说事件监听器完全消失了。当用户在gui组件上激发某个事件的时候，组件自己特定的方法将会负责处理该事件。</p>
<h2 id="比较">比较</h2><p>对于基于监听的事件处理模型来说，事件源和事件监听器是分离的，当事件源上发生特定的事件后，该事件交给事件监听器处理；对于基于回调的事件处理模型来说，事件源和事件监听器是统一的，当事件源发生特定的事件后，该事件还是由事件源本身负责处理。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>






  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/7/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/9/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 sqtds
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/mobile.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>